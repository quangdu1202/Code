<!DOCTYPE html>
<html lang="en" xmlns:x-transition="http://www.w3.org/1999/xhtml">

<head>
    <meta charset="UTF-8"/>
    <meta content="width=device-width,initial-scale=1" name="viewport"/>
    <title>Sankaku Browsing</title>
    <link href="styles.css" rel="stylesheet"/>
    <script defer="defer" src="alpinejs.min.js"></script>
    <script src="scripts.js"></script>
</head>

<body class="flex items-center justify-center">
<div class="flex min-h-screen w-full flex-col items-center justify-center rounded-lg border bg-white shadow-lg"
     x-data="initSankakuTools()"
     x-init="init()">
    <div class="fixed inset-0 z-50 flex h-full w-full items-center justify-center bg-gray-800 bg-opacity-50"
         x-cloak x-show="isLoading" x-transition:enter="ease-out duration-200" x-transition:enter-end="opacity-100"
         x-transition:enter-start="opacity-0" x-transition:leave="ease-in duration-200"
         x-transition:leave-end="opacity-0" x-transition:leave-start="opacity-100">
        <svg class="h-16 w-16 animate-spin text-green-800" viewBox="0 0 50 50" xmlns="http://www.w3.org/2000/svg">
            <circle class="opacity-25" cx="25" cy="25" fill="none" r="20" stroke="currentColor"
                    stroke-width="4"></circle>
            <path class="opacity-75" d="M25 5A20 20 0 0 1 45 25h-5a15 15 0 0 0-15-15V5z" fill="currentColor"></path>
        </svg>
    </div>
    <template x-if="!token.hasToken">
        <form @submit.prevent="getToken()" class="max-w-screen-lg">
            <h2 class="mb-4 text-center text-2xl font-bold text-red">Missing tokens, login first</h2>
            <div class="mb-4">
                <label class="mb-2 block font-bold text-gray-700" for="username">Username</label>
                <input class="w-full rounded-lg border px-4 py-2 focus:outline-none focus:ring-2 focus:ring-indigo-500"
                       id="username" name="login" placeholder="Enter your username" required
                       type="text"
                       x-model="loginData.login"/>
            </div>
            <div class="mb-4">
                <label class="mb-2 block font-bold text-gray-700" for="password">Password</label>
                <input class="w-full rounded-lg border px-4 py-2 focus:outline-none focus:ring-2 focus:ring-indigo-500"
                       id="password" name="password" placeholder="Enter your password" required
                       type="password"
                       x-model="loginData.password"/>
            </div>
            <div class="flex justify-center">
                <button class="rounded-lg bg-blue-500 px-4 py-2 font-bold text-white hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500"
                        type="submit">
                    Login
                </button>
            </div>
        </form>
    </template>
    <template x-if="token.hasToken">
        <div class="grid w-full grid-cols-2 gap-4">
            <div class="col-span-2 hidden w-full">
                <div class="my-2"><strong>Token Type: </strong><span x-text="token.token_type"></span></div>
                <div class="my-2">
                    <strong>Token:</strong>
                    <button @click="copyToken()"
                            class="mx-2 rounded bg-green-100 text-sm font-semibold text-green-800 px-2.5 py-0.5 hover:bg-green-300">
                        Copy
                    </button>
                    <small class="break-words" x-ref="token" x-show="false" x-text="token.access_token"></small><span>expire at
              <span x-text="token.expiry_date"></span></span>
                </div>
                <div class="my-2">
                    <strong>Refresh Token:</strong>
                    <button @click="copyRefreshToken()"
                            class="rounded bg-green-100 text-sm font-semibold text-green-800 px-2.5 py-0.5 me-2 hover:bg-green-300">
                        Copy
                    </button>
                    <small class="break-words" x-ref="refreshToken" x-show="false"
                           x-text="token.refresh_token"></small><span>expire
              at <span x-text="token.refresh_expiry_date"></span></span>
                </div>
            </div>

            <div class="w-full p-4">
                <form @submit.prevent="processFile()" class="mt-4">
                    <div class="mb-4">
                        <label class="mb-2 block font-bold text-gray-700" for="file">Select a file</label>
                        <input @change="handleFileUpload(event)"
                               class="w-full rounded-lg border px-4 py-2 focus:outline-none focus:ring-2 focus:ring-indigo-500"
                               id="file"
                               type="file"/>
                    </div>
                    <div class="flex justify-center gap-4">
                        <button class="rounded-lg bg-green-500 px-4 py-2 font-bold text-white hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-green-500"
                                type="submit">
                            Process File
                        </button>
                        <button @click="downloadTagsJson()"
                                class="rounded-lg bg-blue-500 px-4 py-2 font-bold text-white hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500"
                                type="button">
                            JSON Content
                        </button>
                        <button @click="directDownloadTagsJson()"
                                class="rounded-lg bg-blue-500 px-4 py-2 font-bold text-white hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500"
                                type="button">
                            Direct Download JSON
                        </button>
                    </div>
                </form>

                <button @click="testFetchImage().catch(console.error)">
                    Test
                </button>

                <!--Main data-->
                <div class="my-8">
                    <div class="mb-4 flex flex-col md:space-x-4 md:flex-row md:items-center">
                        <div class="mb-4 flex flex-col md:mb-0">
                            <label class="font-semibold" for="followFilter">Following Status:</label>
                            <select @change="filterTags()"
                                    class="mt-1 rounded border-gray-300 shadow-sm focus:border-indigo-500 focus:ring focus:ring-indigo-200 focus:ring-opacity-50"
                                    id="followFilter"
                                    x-model="selectedFollowFilter">
                                <option value="all">All</option>
                                <option value="1">Following</option>
                                <option value="0">Error / Not Following</option>
                            </select>
                        </div>
                        <div class="flex flex-col">
                            <label class="font-semibold" for="statusFilter">Fetch Status:</label>
                            <select @change="filterTags()"
                                    class="mt-1 rounded border-gray-300 shadow-sm focus:border-indigo-500 focus:ring focus:ring-indigo-200 focus:ring-opacity-50"
                                    id="statusFilter"
                                    x-model="selectedFetchFilter">
                                <option value="all">All</option>
                                <option value="1">Fetched</option>
                                <option value="0">Error / Unfetched</option>
                            </select>
                        </div>
                        <div class="relative flex flex-col">
                            <label class="font-semibold" for="searchTag">Search:</label>
                            <input @focus.debounce.500="getTagSearchSuggestions($el)"
                                   @input.debounce="searchTagSuggestionsFetched = false; console.log('changed')"
                                   @input.debounce.1000="getTagSearchSuggestions($el)"
                                   class="mr-2 rounded border p-1 text-sm"
                                   id="searchTag"
                                   type="text">
                        </div>
                    </div>
                    <div class="mt-4" id="fileData"
                         style="max-height: 620px; overflow-y: scroll; border: 1px solid #000;">
                        <table class="min-w-full table-fixed border border-gray-300 divide-y divide-gray-200">
                            <thead>
                            <tr class="text-center text-sm font-semibold uppercase tracking-wider text-gray-500">
                                <th class="sticky top-0 w-24 bg-gray-200 px-4 py-2">No.</th>
                                <th class="sticky top-0 w-36 bg-gray-200 px-4 py-2">ID</th>
                                <th class="sticky top-0 bg-gray-200 px-4 py-2">
                        <span @click="sortTags('name')" class="cursor-pointer">
                          Name
                          <span x-show="sortBy === 'name'">
                            <template x-if="sortDesc"><span>▼</span></template>
                            <template x-if="!sortDesc"><span>▲</span></template>
                          </span>
                        </span>
                                </th>
                                <th class="sticky top-0 w-48 bg-gray-200 px-4 py-2">
                        <span @click="sortTags('following')" class="block cursor-pointer text-center">
                          Following
                          <span x-show="sortBy === 'following'">
                            <template x-if="sortDesc"><span>▼</span></template>
                            <template x-if="!sortDesc"><span>▲</span></template>
                          </span>
                        </span>
                                    <div class="flex justify-center gap-2">
                                        <button @click="fetchFollowingTags().catch(console.error)"
                                                class="rounded bg-blue-500 px-2 py-1 text-xs text-white hover:bg-blue-700">
                                            <svg fill="none" height="12" stroke="currentColor"
                                                 stroke-linecap="round"
                                                 stroke-linejoin="round" stroke-width="2" viewBox="0 0 24 24"
                                                 width="12"
                                                 xmlns="http://www.w3.org/2000/svg">
                                                <polyline points="1 4 1 10 7 10"/>
                                                <polyline points="23 20 23 14 17 14"/>
                                                <path d="M20.49 9A9 9 0 0 0 6.6 5.2L1 10"/>
                                                <path d="M3.51 15A9 9 0 0 0 17.4 18.8L23 14"/>
                                            </svg>
                                        </button>
                                        <button @click="handleFollowSelectedTags(isToFollow = false).catch(console.error)"
                                                class="rounded bg-red-500 px-2 py-1 text-xs text-white hover:bg-red-700">
                                            <svg fill="none" height="12" stroke="currentColor"
                                                 stroke-linecap="round"
                                                 stroke-linejoin="round" stroke-width="2" viewBox="0 0 24 24"
                                                 width="12"
                                                 xmlns="http://www.w3.org/2000/svg">
                                                <line x1="18" x2="6" y1="6" y2="18"/>
                                                <line x1="6" x2="18" y1="6" y2="18"/>
                                            </svg>
                                        </button>
                                        <button @click="handleFollowSelectedTags(isToFollow = true).catch(console.error)"
                                                class="rounded bg-green-500 px-2 py-1 text-xs text-white hover:bg-green-700">
                                            <svg fill="none" height="12" stroke="currentColor"
                                                 stroke-linecap="round"
                                                 stroke-linejoin="round" stroke-width="2" viewBox="0 0 24 24"
                                                 width="12"
                                                 xmlns="http://www.w3.org/2000/svg">
                                                <polyline points="20 6 9 17 4 12"/>
                                            </svg>
                                        </button>
                                    </div>
                                </th>
                                <th class="sticky top-0 w-16 bg-gray-200 px-4 py-2">
                                    <button @click="selectAll()" class="flex w-full items-center justify-center">
                                        <svg fill="none" height="30px" viewBox="0 0 24 30"
                                             width="24px"
                                             x="0px" xmlns="http://www.w3.org/2000/svg" y="0px">
                                            <path clip-rule="evenodd"
                                                  d="M4 1C2.34315 1 1 2.34315 1 4V20C1 21.6569 2.34315 23 4 23H20C21.6569 23 23 21.6569 23 20V4C23 2.34315 21.6569 1 20 1H4ZM3 4C3 3.44772 3 3 4 3H20C20.5523 3 21 3.44772 21 4V20C21 20.5523 20.5523 21 20 21H4C3.44772 21 3 20.5523 3 20V4Z"
                                                  fill="black"
                                                  fill-rule="evenodd"/>
                                            <path d="M18.7071 8.70711C19.0976 8.31658 19.0976 7.68342 18.7071 7.29289C18.3166 6.90237 17.6834 6.90237 17.2929 7.29289L10 14.5858L6.70711 11.2929C6.31658 10.9024 5.68342 10.9024 5.29289 11.2929C4.90237 11.6834 4.90237 12.3166 5.29289 12.7071L9.29289 16.7071C9.68342 17.0976 10.3166 17.0976 10.7071 16.7071L18.7071 8.70711Z"
                                                  fill="black"
                                                  x-show="selectedAll"/>
                                        </svg>
                                    </button>
                                </th>
                            </tr>
                            </thead>
                            <tbody class="bg-white divide-y divide-gray-200">
                            <template :key="index" x-for="(tag, index) in filteredTags">
                                <tr :class="index % 2 === 1 ? 'bg-gray-50' : ''">
                                    <td :class="tag.fetched === true ? 'text-green-700' : (tag.fetched === null ? 'text-red-700' : '')"
                                        class="px-4 py-2 text-center text-sm text-gray-900"
                                        x-text="index + 1">
                                    </td>
                                    <td :class="tag.fetched === true ? 'text-green-700' : (tag.fetched === null ? 'text-red-700' : '')"
                                        class="px-4 py-2 text-center text-sm text-gray-900"
                                        x-text="tag.id ?? 'null'">
                                    </td>
                                    <td @mouseleave="hideTagsUrl()"
                                        class="overflow-visible px-4 py-2 text-sm text-gray-900 group">
                                        <div class="relative flex items-center justify-between">
                                            <div class="flex grow items-center">
                                                <svg
                                                        @click="removeTag(tag)"
                                                        class="invisible mr-4 cursor-pointer opacity-80 group-hover:visible hover:opacity-100"
                                                        height="20px"
                                                        viewBox="0 0 1024 1024" width="20px"
                                                        xmlns="http://www.w3.org/2000/svg">
                                                    <path
                                                            d="M779.5 1002.7h-535c-64.3 0-116.5-52.3-116.5-116.5V170.7h768v715.5c0 64.2-52.3 116.5-116.5 116.5zM213.3 256v630.1c0 17.2 14 31.2 31.2 31.2h534.9c17.2 0 31.2-14 31.2-31.2V256H213.3z"
                                                            fill="#f51818"/>
                                                    <path
                                                            d="M917.3 256H106.7C83.1 256 64 236.9 64 213.3s19.1-42.7 42.7-42.7h810.7c23.6 0 42.7 19.1 42.7 42.7S940.9 256 917.3 256zM618.7 128H405.3c-23.6 0-42.7-19.1-42.7-42.7s19.1-42.7 42.7-42.7h213.3c23.6 0 42.7 19.1 42.7 42.7S642.2 128 618.7 128zM405.3 725.3c-23.6 0-42.7-19.1-42.7-42.7v-256c0-23.6 19.1-42.7 42.7-42.7S448 403 448 426.6v256c0 23.6-19.1 42.7-42.7 42.7zM618.7 725.3c-23.6 0-42.7-19.1-42.7-42.7v-256c0-23.6 19.1-42.7 42.7-42.7s42.7 19.1 42.7 42.7v256c-0.1 23.6-19.2 42.7-42.7 42.7z"
                                                            fill="#5F6379"/>
                                                </svg>
                                                <!-- Display the tag as a link if fetched is true and not in edit mode -->
                                                <a :href="getTagPostsUrl(tag)"
                                                   :title="tag.tagName"
                                                   class="mr-2 text-blue-600 hover:underline" target="_blank"
                                                   x-show="!tag.isEditing && tag.fetched === true"
                                                   x-text="tag.tagName"></a>
                                                <!-- Display the tag name as plain text if fetched is false and not in edit mode -->
                                                <span :title="tag.tagName"
                                                      class="mr-2"
                                                      x-show="!tag.isEditing && tag.fetched !== true"
                                                      x-text="tag.tagName"></span>

                                                <!-- Input field for editing the tag name, shown regardless of fetched status when in edit mode-->
                                                <input @click.away="delete tag.isEditing"
                                                       @focus.debounce.500="getTagSearchSuggestions($el)"
                                                       @input.debounce="searchTagSuggestionsFetched = false; console.log('changed')"
                                                       @input.debounce.1000="getTagSearchSuggestions($el)"
                                                       @keydown.enter="tag.isEditing = false"
                                                       class="mr-2 rounded border p-1 text-sm"
                                                       type="text"
                                                       x-model="tag.tagName"
                                                       x-show="tag.isEditing">

                                                <!-- Toggle edit mode-->
                                                <button class="invisible ml-1 opacity-80 group-hover:visible hover:opacity-100">
                                                    <!--Edit icon-->
                                                    <svg @click="tag.isEditing = true" class="icon"
                                                         height="18px" viewBox="0 0 1024 1024"
                                                         width="18px" x-show="!tag.isEditing"
                                                         xmlns="http://www.w3.org/2000/svg">
                                                        <title x-text="`Edit tag name`"></title>
                                                        <path d="M823 939H229c-71 0-129-58-129-130V215c0-71 58-130 129-130h297a43 43 0 1 1 0 86H229c-24 0-44 20-44 44v594c0 25 20 44 44 44h594c25 0 45-20 45-44V512a43 43 0 1 1 85 0v297c0 72-58 130-130 130z"
                                                              fill="#3688FF"/>
                                                        <path d="m483 757-5-1-135-17c-19-2-34-17-37-37l-17-134c-1-13 3-26 13-36l374-374c51-51 134-51 186 0l26 26c25 25 38 58 38 93s-13 68-38 93L513 744c-8 8-19 13-30 13zm-96-98 80 10 360-360a45 45 0 0 0 0-65l-26-26a46 46 0 0 0-65 0L377 578l10 81z"
                                                              fill="#5F6379"/>
                                                    </svg>

                                                    <!--Confirm icon-->
                                                    <svg @click="delete tag.isEditing" fill="none"
                                                         height="18px" stroke="currentColor"
                                                         viewBox="0 0 24 24" width="18px" x-show="tag.isEditing"
                                                         xmlns="http://www.w3.org/2000/svg">
                                                        <title x-text="`Tag name has changed`"></title>
                                                        <path d="M6 12L10.2426 16.2426L18.727 7.75732" id="Vector"
                                                              stroke="#000000"
                                                              stroke-linecap="round" stroke-linejoin="round"
                                                              stroke-width="3"/>
                                                    </svg>
                                                </button>
                                            </div>
                                            <div class="flex items-center gap-2" x-show="tag.fetched">
                                                    <span class="italic text-gray-500"
                                                          x-text="formatPostCount(tag.post_count)"></span>
                                                <button @mouseover="showTagsUrl(tag, $el)">
                                                    <svg fill="none" height="24px"
                                                         viewBox="0 0 24 24" width="24px"
                                                         xmlns="http://www.w3.org/2000/svg">
                                                        <path d="M10.0002 5H8.2002C7.08009 5 6.51962 5 6.0918 5.21799C5.71547 5.40973 5.40973 5.71547 5.21799 6.0918C5 6.51962 5 7.08009 5 8.2002V15.8002C5 16.9203 5 17.4801 5.21799 17.9079C5.40973 18.2842 5.71547 18.5905 6.0918 18.7822C6.5192 19 7.07899 19 8.19691 19H15.8031C16.921 19 17.48 19 17.9074 18.7822C18.2837 18.5905 18.5905 18.2839 18.7822 17.9076C19 17.4802 19 16.921 19 15.8031V14M20 9V4M20 4H15M20 4L13 11"
                                                              id="Vector"
                                                              stroke="#000000" stroke-linecap="round"
                                                              stroke-linejoin="round" stroke-width="2"/>
                                                    </svg>
                                                </button>
                                            </div>
                                        </div>
                                    </td>
                                    <td class="px-4 py-2 text-center text-sm text-gray-900">
                                        <template x-if="tag.fetched !== true">
                                            <button class="rounded bg-gray-500 px-4 py-1 text-white"
                                                    disabled="disabled">-
                                            </button>
                                        </template>
                                        <template x-if="tag.fetched === true && tag.following === false">
                                            <button @click="handleFollowSelectedTags(isToFollow = true, singleTag = tag).catch(console.error)"
                                                    class="rounded bg-green-500 px-4 py-1 text-white hover:bg-green-700">
                                                Follow
                                            </button>
                                        </template>
                                        <template x-if="tag.fetched === true && tag.following === true">
                                            <button @click="handleFollowSelectedTags(isToFollow = false, singleTag = tag).catch(console.error)"
                                                    class="rounded bg-red-500 px-4 py-1 text-white hover:bg-red-700">
                                                Unfollow
                                            </button>
                                        </template>
                                    </td>
                                    <td class="px-4 py-2 text-center text-sm text-gray-900">
                                        <button :disabled="tag.fetched !== true"
                                                @click="selectTag(tag)"
                                                class="flex w-full items-center justify-center">
                                            <svg fill="none" height="30px" viewBox="0 0 24 30"
                                                 width="24px"
                                                 x="0px" xmlns="http://www.w3.org/2000/svg" y="0px">
                                                <path clip-rule="evenodd"
                                                      d="M4 1C2.34315 1 1 2.34315 1 4V20C1 21.6569 2.34315 23 4 23H20C21.6569 23 23 21.6569 23 20V4C23 2.34315 21.6569 1 20 1H4ZM3 4C3 3.44772 3 3 4 3H20C20.5523 3 21 3.44772 21 4V20C21 20.5523 20.5523 21 20 21H4C3.44772 21 3 20.5523 3 20V4Z"
                                                      fill="black"
                                                      fill-rule="evenodd"/>
                                                <path d="M18.7071 8.70711C19.0976 8.31658 19.0976 7.68342 18.7071 7.29289C18.3166 6.90237 17.6834 6.90237 17.2929 7.29289L10 14.5858L6.70711 11.2929C6.31658 10.9024 5.68342 10.9024 5.29289 11.2929C4.90237 11.6834 4.90237 12.3166 5.29289 12.7071L9.29289 16.7071C9.68342 17.0976 10.3166 17.0976 10.7071 16.7071L18.7071 8.70711Z"
                                                      fill="black"
                                                      x-show="tag.selected"/>
                                            </svg>
                                        </button>
                                    </td>
                                </tr>
                            </template>
                            </tbody>
                        </table>
                    </div>
                </div>


                <template x-if="recentlyUnfollowedTags.length > 0">
                    <div class="mt-8">
                        <div class="my-4 flex items-center gap-4">
                            <span class="font-bold">Recently Unfollowed Tags</span>
                            <button @click="if(confirm('Are you sure?')) {recentlyUnfollowedTags = []; updateLocalStorageForTags()}"
                                    class="rounded-lg bg-blue-500 px-2 py-1 font-bold text-white hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500"
                                    type="button">
                                Clear
                            </button>
                        </div>
                        <table class="w-full table-fixed border-collapse border border-gray-400">
                            <thead>
                            <tr class="bg-gray-200">
                                <th class="sticky -top-px border border-gray-400 bg-gray-200 px-4 py-2">No.</th>
                                <th class="sticky -top-px border border-gray-400 bg-gray-200 px-4 py-2">ID</th>
                                <th class="sticky -top-px w-3/4 border border-gray-400 bg-gray-200 px-4 py-2">
                      <span @click="sortTags('name')" class="block cursor-pointer">
                        Name
                        <span x-show="sortBy === 'name'">
                          <template x-if="sortDesc"><span>▼</span></template>
                          <template x-if="!sortDesc"><span>▲</span></template>
                        </span>
                      </span>
                                </th>
                            </tr>
                            </thead>
                            <tbody>
                            <template :key="index" x-for="(tag, index) in recentlyUnfollowedTags">
                                <tr>
                                    <td :class="tag.fetched === true ? 'text-green-700' : (tag.fetched === null ? 'text-red-700' : '')"
                                        class="border border-gray-400 px-4 py-2 text-center"
                                        x-text="index + 1">
                                    </td>
                                    <td :class="(tag.fetched === true ? 'text-green-700' : (tag.fetched === null ? 'text-red-700' : ''))"
                                        class="border border-gray-400 px-4 py-2 text-center"
                                        x-text="tag.id ?? 'null'">
                                    </td>
                                    <td :title="tag.tagName" class="truncate border border-gray-400 px-4 py-2">
                                        <template x-if="tag.fetched === true"><a :href="getTagPostsUrl(tag)"
                                                                                 class="text-blue-600 hover:underline"
                                                                                 target="_blank"
                                                                                 x-text="tag.tagName"></a></template>
                                        <template x-if="tag.fetched !== true"><span x-text="tag.tagName"></span>
                                        </template>
                                    </td>
                                </tr>
                            </template>
                            </tbody>
                        </table>
                    </div>
                </template>
            </div>

            <!-- Section to show posts for selected tag -->
            <div class="relative max-h-screen w-full overflow-y-scroll p-4">
                <div>
                    <h2 class="mb-4 text-lg font-bold">Posts for: <span x-text="selectedTagToShowPosts.tagName"></span>
                    </h2>
                    <p class="text-right text-sm text-gray-500">Total posts fetched: <span
                            x-text="selectedTagToShowPosts.fetchedPostCount || 0"></span></p>
                </div>

                <!-- Loader -->
                <div class="absolute inset-0 z-50 flex h-full w-full items-center justify-center bg-gray-800 bg-opacity-50"
                     x-cloak x-show="isFetchingPosts" x-transition:enter="ease-out duration-200"
                     x-transition:enter-end="opacity-100" x-transition:enter-start="opacity-0"
                     x-transition:leave="ease-in duration-200" x-transition:leave-end="opacity-0"
                     x-transition:leave-start="opacity-100">
                    <svg class="h-16 w-16 animate-spin text-green-800" viewBox="0 0 50 50"
                         xmlns="http://www.w3.org/2000/svg">
                        <circle class="opacity-25" cx="25" cy="25" fill="none" r="20" stroke="currentColor"
                                stroke-width="4">
                        </circle>
                        <path class="opacity-75" d="M25 5A20 20 0 0 1 45 25h-5a15 15 0 0 0-15-15V5z"
                              fill="currentColor"></path>
                    </svg>
                </div>

                <!-- x-show="isShowingPosts" x-cloak -->
                <div>
                    <!-- Posts Per Page Selection -->
                    <div class="mb-4">
                        <label class="mr-2" for="postsPerPage">Posts per page:</label>
                        <select @change="updateTotalPages()" class="rounded border px-2 py-1" id="postsPerPage"
                                x-model="postsPerPage">
                            <option value="10">10</option>
                            <option selected value="20">20</option>
                            <option value="50">50</option>
                            <option value="100">100</option>
                        </select>
                    </div>

                    <!-- Masonry layout for posts -->
                    <div class="gap-4 sm:columns-1 md:columns-2 lg:columns-3">
                        <template :key="post.id" x-for="(post, index) in paginatedPosts">
                            <!-- Scale container (applies to both image and overlay) -->
                            <div class="relative mb-4 transform overflow-hidden rounded shadow-lg transition-transform duration-300 ease-in-out group hover:scale-105">

                                <!-- Image -->
                                <img :src="post.preview_url" alt="Post Preview"
                                     class="h-auto w-full rounded object-cover"
                                     loading="lazy" src=""/>

                                <!-- Button to toggle post information -->
                                <button @click="post.showInfo = !post.showInfo"
                                        aria-label="Show post info"
                                        class="absolute top-2 right-2 rounded bg-gray-800 px-2 py-1 text-xs text-white opacity-0 shadow-lg transition-opacity duration-300 group-hover:opacity-100">
                                    Info
                                </button>

                                <!-- Like button -->
                                <button @click="handleFollowPost(post)"
                                        class="right-2 bottom-2 z-20 absolute flex justify-center items-center bg-white opacity-0 group-hover:opacity-70 hover:!opacity-100 hover:scale-105 shadow-lg rounded-full w-8 h-8 transition-all duration-300">
                                    <svg :class="post.is_favorited ? 'text-red-500' : 'text-white'" fill="currentColor"
                                         height="24px"
                                         viewBox="0 0 24 24"
                                         width="24px" xmlns="http://www.w3.org/2000/svg">
                                        <path clip-rule="evenodd"
                                              d="M12 6.00019C10.2006 3.90317 7.19377 3.2551 4.93923 5.17534C2.68468 7.09558 2.36727 10.3061 4.13778 12.5772C5.60984 14.4654 10.0648 18.4479 11.5249 19.7369C11.6882 19.8811 11.7699 19.9532 11.8652 19.9815C11.9483 20.0062 12.0393 20.0062 12.1225 19.9815C12.2178 19.9532 12.2994 19.8811 12.4628 19.7369C13.9229 18.4479 18.3778 14.4654 19.8499 12.5772C21.6204 10.3061 21.3417 7.07538 19.0484 5.17534C16.7551 3.2753 13.7994 3.90317 12 6.00019Z"
                                              fill-rule="evenodd"
                                              stroke="#ef4444"
                                              stroke-linecap="round"
                                              stroke-linejoin="round" stroke-width="2"/>
                                    </svg>
                                </button>

                                <!-- Post information overlay with toggle -->
                                <div class="absolute right-0 bottom-0 left-0 z-10 rounded-b bg-black bg-opacity-60 p-2 text-xs text-white transition-all duration-500 ease-in-out"
                                     x-show="post.showInfo"
                                     x-transition:enter="transition ease-out duration-500"
                                     x-transition:enter-end="opacity-100 transform translate-y-0"
                                     x-transition:enter-start="opacity-0 transform translate-y-4"
                                     x-transition:leave="transition ease-in duration-500"
                                     x-transition:leave-end="opacity-0 transform translate-y-4"
                                     x-transition:leave-start="opacity-100 transform translate-y-0">
                                    <p x-text="'Type: ' + post.file_type"></p>
                                    <p x-text="'Rating: ' + post.rating"></p>
                                    <p x-text="'Size: ' + formatFileSize(post.file_size)"></p>
                                    <p x-text="'Dimensions: ' + post.width + ' x ' + post.height"></p>
                                </div>
                            </div>
                        </template>
                    </div>

                    <!-- Pagination Controls -->
                    <div class="sticky -bottom-4 -mx-4 mt-4 inline-flex h-10 items-center text-base -space-x-px">
                        <!-- Previous Button -->
                        <button :class="currentPage !== 1 ? 'bg-gray-800 hover:bg-gray-700 hover:border-gray-700 hover:text-white' :'bg-gray-700'"
                                :disabled="currentPage === 1"
                                @click="prevPage()"
                                class="flex h-10 items-center justify-center border border-gray-800 px-4 leading-tight text-gray-400 rounded-s-lg">
                            <span class="sr-only">Previous</span>
                            <svg aria-hidden="true" class="h-3 w-3 rtl:rotate-180" fill="none"
                                 viewBox="0 0 6 10"
                                 xmlns="http://www.w3.org/2000/svg">
                                <path d="M5 1 1 5l4 4" stroke="currentColor" stroke-linecap="round"
                                      stroke-linejoin="round"
                                      stroke-width="2"/>
                            </svg>
                        </button>

                        <!-- Editable Current Page -->
                        <span class="flex h-10 items-center justify-center gap-2 border-2 border-gray-700 bg-gray-800 px-2 leading-tight text-gray-400">
                            <span class="inline-block w-10 border-none bg-transparent text-center outline-none py-2.5">Page</span>
                            <!-- Editable input for current page -->
                            <input :max="totalPages" :value="currentPage" @blur="validatePage($el)"
                                   @change="jumpToPage($el)"
                                   class="w-10 border-none bg-gray-700 text-center text-gray-200 outline-none py-2.5 hover:bg-gray-600"
                                   min="1" type="number"/>
                            <span class="inline-block w-10 border-none bg-transparent text-center outline-none py-2.5">of</span>
                            <span class="inline-block w-10 border-none bg-transparent text-center text-gray-400 outline-none py-2.5"
                                  x-text="totalPages"></span>
                        </span>

                        <!-- Next Button -->
                        <button :class="currentPage !== totalPages ? 'bg-gray-800 hover:bg-gray-700 hover:border-gray-700 hover:text-white' :'bg-gray-700'"
                                :disabled="currentPage === totalPages"
                                @click="nextPage()"
                                class="flex h-10 items-center justify-center border border-gray-800 px-4 leading-tight text-gray-200 rounded-e-lg">
                            <span class="sr-only">Next</span>
                            <svg aria-hidden="true" class="h-3 w-3 rtl:rotate-180" fill="none"
                                 viewBox="0 0 6 10"
                                 xmlns="http://www.w3.org/2000/svg">
                                <path d="m1 9 4-4-4-4" stroke="currentColor" stroke-linecap="round"
                                      stroke-linejoin="round"
                                      stroke-width="2"/>
                            </svg>
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </template>

    <!-- Global suggestions container (only one for all rows) -->
    <div @click.away="hideSuggestions()"
         class="absolute z-50 mt-2 hidden rounded border border-gray-300 bg-white shadow-sm"
         x-ref="suggestionsContainer">
        <template x-if="searchTagSuggestions.length > 0">
            <ul>
                <template :key="suggestion.id" x-for="suggestion in searchTagSuggestions">
                    <li @click="applySuggestion(suggestion)"
                        class="flex cursor-pointer justify-between gap-8 px-4 py-2 hover:bg-gray-100">
                        <span x-text="suggestion.name"></span>
                        <div class="inline-flex items-center justify-between gap-2">
                            <span class="text-xs text-gray-500"
                                  x-text="suggestion.rating ? suggestion.rating : ''"></span>
                            <span class="text-xs text-gray-500" x-text="formatPostCount(suggestion.post_count)"></span>
                        </div>
                    </li>
                </template>
            </ul>
        </template>
        <template x-if="searchTagSuggestions.length === 0">
            <p>
                No suggestions found
            </p>
        </template>
    </div>

    <!-- Global tag urls container | change grid or hidden class by js -->
    <div @mouseleave="hideTagsUrl()"
         class="absolute z-50 mt-2 hidden grid-cols-2 rounded border border-gray-300 bg-white shadow-sm divide-x"
         x-ref="tagUrlsContainer">
        <a class="relative flex items-center justify-between px-4 py-2 hover:bg-gray-100" href="" target="_blank"
           x-ref="tagWikiUrlEl">
            Wiki
            <svg class="float-right ml-2" fill="none" height="12px" viewBox="0 0 16 16"
                 width="12px"
                 xmlns="http://www.w3.org/2000/svg">
                <path d="M7 13V10H0L1.74846e-07 6L7 6L7 3L8 3L13 8L8 13H7Z" fill="#000000"/>
                <path d="M14 14V2L16 2V14H14Z" fill="#000000"/>
            </svg>
        </a>
        <button @click="fetchAllPostsOfTag(currentTag).catch(console.error)"
                class="relative flex items-center justify-between px-4 py-2 hover:bg-gray-100"
                x-ref="tagPostsUrlEl">
            Posts
            <svg class="float-right ml-2" fill="none" height="12px" viewBox="0 0 16 16"
                 width="12px"
                 xmlns="http://www.w3.org/2000/svg">
                <path d="M7 13V10H0L1.74846e-07 6L7 6L7 3L8 3L13 8L8 13H7Z" fill="#000000"/>
                <path d="M14 14V2L16 2V14H14Z" fill="#000000"/>
            </svg>
        </button>
    </div>
</div>
    <div id="notification-container" class="fixed flex w-full flex-wrap gap-2 bottom-2.5">

    </div>
</body>

</html>